<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Site</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#111; color:#eee;}
  .tabs { display:flex; background:#222; }
  .tab { padding:10px 20px; cursor:pointer; border-bottom:2px solid transparent;}
  .tab.active { border-bottom:2px solid #ff6; }
  .tab-content { display:none; padding:20px; }
  .tab-content.active { display:block; }
  #mapContainer { width: 100%; height: 400px; border:2px solid #555; margin-bottom:10px; }
  #sidePanel { max-height:150px; overflow-y:auto; border-top:1px solid #555; padding-top:5px; }
  input, button { padding:5px; margin-top:5px; background:#222; border:1px solid #555; color:#eee; }
  .glow-marker { width:12px; height:12px; background:#ff6; border-radius:50%; box-shadow:0 0 10px #ff6; }
  hr { border-color:#555; }
  /* Password overlay */
  #passwordOverlay { position:fixed; top:0; left:0; width:100%; height:100%;
    background:#111; color:#eee; display:flex; flex-direction:column;
    align-items:center; justify-content:center; z-index:9999; }
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // --- FIREBASE CONFIGURATION ---
  const firebaseConfig = {
    apiKey: "AIzaSyBk7vpprHqVv1ILc4rruIiS4bSZRzkQs1Y",
    authDomain: "sdasasdasd-6eb06.firebaseapp.com",
    projectId: "sdasasdasd-6eb06",
    storageBucket: "sdasasdasd-6eb06.firebasestorage.app",
    messagingSenderId: "983557131474",
    appId: "1:983557131474:web:c6858896718d6e10b3f10b"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

</head>
<body>

<!-- Password Overlay -->
<div id="passwordOverlay">
  <h2>Enter Password</h2>
  <input type="password" id="sitePassword" placeholder="Password"/>
  <button onclick="checkPassword()">Enter</button>
  <div id="passwordError" style="color:red; margin-top:10px;"></div>
</div>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-tab="mapTab">Map</div>
  <div class="tab" data-tab="historyTab">Music Facts</div>
  <div class="tab" data-tab="songTab">Song Log</div>
</div>

<div id="mapTab" class="tab-content active">
  <div id="mapContainer"></div>
  <div id="sidePanel"></div>
</div>

<div id="historyTab" class="tab-content">
  <div id="musicFact">Loading music fact...</div>
</div>

<div id="songTab" class="tab-content">
  <input type="text" id="songInput" placeholder="Add a song"/>
  <button onclick="addSong()">Add Song</button>
  <div id="songs">Loading...</div>
</div>

<script>
// --- PASSWORD ---
const correctPassword = "fjollabore"; // <-- change this
function checkPassword() {
  const val = document.getElementById("sitePassword").value;
  if(val === correctPassword) {
    document.getElementById("passwordOverlay").style.display = "none";
  } else {
    document.getElementById("passwordError").innerText = "Incorrect password!";
  }
}

// --- Tabs ---
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
  tab.addEventListener('click', ()=>{
    tabs.forEach(t=>t.classList.remove('active'));
    contents.forEach(c=>c.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
  });
});

// --- Map ---
const map = L.map('mapContainer').setView([41.9981,21.4254],6);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{
  attribution:'© OpenStreetMap contributors'
}).addTo(map);
const icon = L.divIcon({ html:'<div class="glow-marker"></div>', iconSize:[12,12] });

function loadPins() {
  document.getElementById("sidePanel").innerHTML = "";
  db.collection("pins").orderBy("time","asc").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const pin = doc.data();
      const marker = L.marker([pin.lat,pin.lng],{icon}).addTo(map);
      marker.bindPopup(`<strong>LOG ENTRY</strong><br>${pin.text}<br/><small>${pin.time.toDate().toLocaleString()}</small>`);
      document.getElementById("sidePanel").innerHTML += `<div>${pin.text}<br/><small>${pin.time.toDate().toLocaleString()}</small><hr/></div>`;
    });
  });
}

map.on('click', function(e){
  const text = prompt("LOG ENTRY (max 120 chars)");
  if(!text) return;
  const time = firebase.firestore.Timestamp.now();
  db.collection("pins").add({
    lat: e.latlng.lat,
    lng: e.latlng.lng,
    text: text,
    time: time
  }).then(() => {
    loadPins();
  });
});

loadPins();

// --- Song Log ---
const songsContainer = document.getElementById("songs");
const songInput = document.getElementById("songInput");

function loadSongs() {
  songsContainer.innerHTML = "Loading...";
  db.collection("songs").orderBy("time","asc").get().then(snapshot => {
    songsContainer.innerHTML = "";
    snapshot.forEach(doc => {
      const song = doc.data();
      songsContainer.innerHTML += `<div>${song.text}<hr/></div>`;
    });
  });
}

function addSong() {
  const val = songInput.value.trim();
  if(!val) return;
  const time = firebase.firestore.Timestamp.now();
  db.collection("songs").add({text: val, time: time}).then(()=>{
    songInput.value = "";
    loadSongs();
  });
}

loadSongs();

// --- Music Facts ---
const facts = [
"Beethoven composed some of his best works while completely deaf.",
"Mozart started composing at age 5.",
"Vivaldi was nicknamed 'The Red Priest'.",
"Johann Sebastian Bach had 20 children.",
"Frederic Chopin wrote mostly for solo piano.",
"Louis Armstrong popularized scat singing.",
"The Beatles hold the record for most number-one hits in the UK.",
"Opera originated in Italy at the end of the 16th century.",
"Antonio Stradivari crafted some of the world's finest violins.",
"Handel wrote 'Messiah' in just 24 days.",
"Jazz originated in New Orleans in the late 19th century.",
"Beethoven’s Ninth Symphony includes a choral finale.",
"Tchaikovsky wrote the Nutcracker ballet.",
"Michael Jackson’s 'Thriller' is the best-selling album of all time.",
"Elvis Presley is known as the 'King of Rock and Roll'.",
"Debussy was inspired by Impressionist painters.",
"Mendelssohn revived interest in Bach’s music.",
"Rachmaninoff was also a famous pianist.",
"Puccini wrote La Bohème and Tosca.",
"Schubert composed over 600 songs.",
"Miles Davis pioneered modal jazz.",
"John Cage composed music using chance operations.",
"Liszt was a virtuosic piano performer.",
"Rimsky-Korsakov wrote Scheherazade.",
"Verdi composed 28 operas.",
"Mahler expanded the size of orchestras.",
"Stravinsky’s 'Rite of Spring' caused a riot at its premiere.",
"Ellington led a big band for over 50 years.",
"Bartók collected folk music from Eastern Europe.",
"Glenn Gould was famous for Bach interpretations.",
"Shostakovich wrote 15 symphonies.",
"Orff created 'Carmina Burana'.",
"Caruso was one of the first recording stars.",
"Gil Evans collaborated with Miles Davis.",
"Carter composed complex modern music.",
"Adams is a leading minimalist composer.",
"Copland captured the American sound.",
"Haydn is called the 'Father of the Symphony'.",
"Handel’s water music was performed on a barge.",
"Pergolesi wrote Stabat Mater.",
"Ravel composed Boléro.",
"Gershwin fused jazz and classical.",
"Schumann’s Dichterliebe is a song cycle.",
"Saint-Saëns wrote Carnival of the Animals.",
"Verklärte Nacht by Schönberg is a late-Romantic work.",
"Barber composed Adagio for Strings.",
"Fauré wrote Requiem.",
"Monteverdi pioneered opera.",
"Telemann was extremely prolific.",
"Biber wrote colorful violin sonatas."
];

function showFact() {
  const today = new Date();
  const index = today.getDate() % facts.length;
  document.getElementById("musicFact").innerText = facts[index];
}

showFact();
</script>

</body>
</html>
